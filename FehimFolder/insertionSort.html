<!DOCTYPE html>

<html>
<head>
  <link rel = "stylesheet" href = "utilities.css">
  <link rel="stylesheet" href="classstyle.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">

        <meta charset = "UTF-8">
        <meta http-equiv = "X-UA-Compatible" content = "IO-edge"></meta>
        <meta name = "viewport" content = "width=device-width, initial-scale = 1.0">
        <title> Algorithm Simulation | Easy to learn</title>
</head>

<body>
<!-- Navbar-->
        
<div class="navbar">
  <div class="container flex">
          <form class = "form-inline my-2 my-lg-0">
              <ul class = "navbar-nav mr-auto">
        <li class="logged-in">
          <a href="#" class="white-text modal-trigger" data-target="modal-account">Account</a>
        </li>
        <li class="logged-in">
          <a href="#" class="white-text" id="logout">Logout</a>
        </li>
        <li class="logged-out" style = "display: none;">
          <a href="#" class="white-text modal-trigger" data-target="modal-login">Login</a>
        </li>
        <li class="logged-out" style = "display: none;">
          <a href="#" class="white-text modal-trigger" data-target="modal-signup">Sign up</a>
        </li>
        <li class="logged-out" style = "display: none;">
          <a href="#" class="white-text modal-trigger" data-target="modal-forgotPassword">Forgot Password?</a>
        </li>
      </ul>
      </form>
      
  </div>
</div>

<!-- REGISTER -->
<div id="modal-signup" class="modal">
  <div class="modal-content">
    <h4>Sign up</h4><br />
    <form id="signup-form">
      <div class="input-field">
        <input type="email" id="signup-email" required />
        <label for="signup-email">Email address</label>
      </div>
      <div class="input-field">
        <input type="password" id="signup-password" required />
        <label for="signup-password">Choose password</label>
      </div>
      <div class="input-field">
          <input type="password" id="signup-confirmPassword" required />
          <label for="signup-confirmPassword">Confirm password</label>
        </div>
      <button class="btn yellow darken-2 z-depth-0">Sign up</button>
    </form>
  </div>
</div>

<!-- LOGIN MODAL WINDOW -->

<div id="modal-login" class="modal">
  <div class="modal-content">
    <h4>Login</h4><br />
    <form id="login-form">
      <div class="input-field">
        <input type="email" id="login-email" required />
        <label for="login-email">Email address</label>
      </div>
      <div class="input-field">
        <input type="password" id="login-password" required />
        <label for="login-password">Your password</label>
      </div>
      <button class="btn yellow darken-2 z-depth-0">Login</button>
    </form>
  </div>
</div>

<!-- ACCOUNT MODAL -->
  <div id="modal-account" class="modal">
      <div class="modal-content center-align">
      <h4>Account details</h4><br />
      <div class="account-details"></div>
      </div>
  </div>

<!-- FORGOT PASSWORD MODAL -->
<div id="modal-forgotPassword" class="modal">
  <div class="modal-content">
    <h4>Forgot Password?</h4><br />
    <form id="forgotPassword-form">
      <div class="input-field">
        <input type="email" id="forgotPassword-email" required />
        <label for="forgotPassword-email">Email address</label>
      </div>
      <button class="btn yellow darken-2 z-depth-0">Forgot Password</button>
    </form>
  </div>
</div>

    <h1>INSERTION SORT</h1>
  </header>

  <section>
    <div id = "parameters_section">
      <div class = "radio_group">
        <form action="#">
          <p>
            <label>
              <input name="array_setup_choice"  id="random_array" type="radio" value="Create Random Array" checked="checked"/>
              <span>RANDOM ARRAY</span>
            </label>
          </p>
          <p>
            <label>
              <input name="array_setup_choice" id="user_array" type="radio" value="Create User Array"/>
              <span>CUSTOM ARRAY</span>
            </label>
          </p> 
        </form>
    </div>
  </div>

      <div class="array_parameters">
        <p>Array Size:</p>
        <input id="size_of_array" type="range" min=5 max=30 step=1 value=20>
        <button id="create_random_array">Generate a random array</button>
      </div>
      <div class="user_input_parameters">
        <label for="array_integer">Integer: </label>
        <input type="text" id="array_integer" name="array_integer">
        <button id="add_integer">ADD</button>
    </div>
    <div class="start_array">
        <button id="start_sort">Start Insertion Sort</button>
    </div>
  </div>
    <div id="array_section">
    </div>
  </section>

<section>
  <div class="radio_group2">
    <div class = "radio_group2">
      <form action="#">
        <p>
          <label for = "view_log">
            <input id = "view_log" name="view_choice" type="radio" value="View Log" checked="checked"/>
            <span>VIEW LOG</span>
          </label>
        </p>
        <p>
          <label for = "view_pseudocode">
            <input id = "view_pseudocode" name="view_choice" type="radio" value="View Pseudocode"/>
            <span>VIEW PSEUDOCODE</span>
          </label>
        </p>
      </form>
    </div>

  <div class="output_views">
  <div class="log_section" id="log_box">
    <p id="title">Log</p>
    <p id="fifth_box"></p>
    <p id="fourth_box"></p>
    <p id="third_box"></p>
    <p id="second_box"></p>
    <p id="first_box"></p>
  </div>



<div class="pseudocode_section" id="pseudocode_box">
  <p id="first_pseudocode_box">for j = 0 to J < arraySize with j++</p>
  <p id="second_pseudocode_box">for j=0 to n-2i >=0 && sortingArray.arrayBarSizes[i]>key</p>
  <p id="third_pseudocode_box">if Array[j] > Array[j+1if (i==(j-1))</p>
  <p id="fourth_pseudocode_box">for var k = 0; k < j; k++</p>
</div>
</div>
</section>
<!-- FOOTER -->
<footer class="footer bg-dark py5">
  <div class="container grid grid-3">
      <div>
          <h1>Algorithm Simulations</h1>
          <p>Copyright &copy; 2022</p>
      </div>
      
          <ul>
              <li><br><a href = "fehimindex3.html">Home</a></li>
          </ul>
          <a href = "https://github.com/WSU-4110/Algo-simulation">
              <img src = "img/github.png" alt = "" style = "position:relative;width:80px;height:80px;"></a>
      
  </div>
</footer>

</section>
<script src="sortingArrayClass.js"></script>
<script src="pseudoCodeClass.js"></script>
<script src="logBoxClass.js"></script>
<script src="insertionsort.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
        <script src="index.js"></script>
        <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.8.3/firebase-app.js";
        import { getAnalytics } from "https://www.gstatic.com/firebasejs/9.8.3/firebase-analytics.js";
        import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged, signOut, sendPasswordResetEmail } from "https://www.gstatic.com/firebasejs/9.8.3/firebase-auth.js";
        import { getDatabase, ref, set, child, get } from "https://www.gstatic.com/firebasejs/9.8.3/firebase-database.js";
        import { getFirestore, collection } from "https://www.gstatic.com/firebasejs/9.8.3/firebase-firestore.js";
                const firebaseConfig = {
                  apiKey: "AIzaSyAK09hAg1puDmfULhLqvCKf86crQ_eyFWI",
                  authDomain: "algo-simulation-7cc87.firebaseapp.com",
                  databaseURL: "https://algo-simulation-7cc87-default-rtdb.firebaseio.com",
                  projectId: "algo-simulation-7cc87",
                  storageBucket: "algo-simulation-7cc87.appspot.com",
                  messagingSenderId: "435094910087",
                  appId: "1:435094910087:web:776c43a33ed8bf4ff6b422",
                  measurementId: "G-1MT1BNZNRK"
                };
          
            // Initialize Firebase
            const app = initializeApp(firebaseConfig);
            const analytics = getAnalytics(app);
            const auth = getAuth();
            const db = getDatabase();
            //db.settings({ timestampsInSnapshots: true });
            const signupForm = document.querySelector('#signup-form');

            signupForm.addEventListener('submit', (e) => {
            e.preventDefault();

            // get user info
            const email = signupForm['signup-email'].value;
            const password = signupForm['signup-password'].value;
            console.log(email, password);
            // sign up the user
            if (!Validation()){
                    return;
                };
            createUserWithEmailAndPassword(auth, email, password)
                .then((userCredential) => {
                // close the signup modal & reset form
                const modal = document.querySelector('#modal-signup');
                M.Modal.getInstance(modal).close();
                signupForm.reset()
                const user = userCredential.user;
                writeUserData(user, email);
                ;})
                .catch((error)=> {
                            const errorCode = error.code;
                            const errorMessage = error.message;

                            alert(errorMessage);
                        })
            });

            // logout
            const logout = document.querySelector('#logout');

            logout.addEventListener('click', (e) => {
                e.preventDefault();
                signOut(auth).then(() => {
                    console.log('user signed out');
                })
                });

            // login
            const loginForm = document.querySelector('#login-form');
            loginForm.addEventListener('submit', (e) => {
            e.preventDefault();
            
            // get user info
            const email = loginForm['login-email'].value;
            const password = loginForm['login-password'].value;

            // log the user in
            signInWithEmailAndPassword(auth, email, password)
            .then((userCredential) => {
                console.log(userCredential.user);
                // close the signup modal & reset form
                const modal = document.querySelector('#modal-login');
                M.Modal.getInstance(modal).close();
                loginForm.reset();
                })
                .catch((error) => {
                        const errorCode = error.code;
                        const errorMessage = error.message;
                    });
            });

            // track auth state changes
            onAuthStateChanged(auth, (user) => {
                if (user) {
                    console.log('user logged in: ', user);
                    setupUI(user);
                    const uid = user.uid;
                } else {
                    console.log('user logged out');
                    setupUI();
                }
                });

                const loggedOutLinks = document.querySelectorAll('.logged-out');
                const loggedInLinks = document.querySelectorAll('.logged-in');
                const accountDetails = document.querySelector('.account-details');

                const setupUI = (user) => {
                if (user) {
                    // account info
                    db.collection('users').doc(user.uid).get().then(doc => {
                    const html = `
                        <div>Logged in as ${user.email}</div>
                        <div>${doc.data().bio}</div>
                    `;
                    accountDetails.innerHTML = html;
                    });
                    // toggle user UI elements
                    loggedInLinks.forEach(item => item.style.display = 'block');
                    loggedOutLinks.forEach(item => item.style.display = 'none');
                } else {
                    // clear account info
                    accountDetails.innerHTML = '';
                    // toggle user elements
                    loggedInLinks.forEach(item => item.style.display = 'none');
                    loggedOutLinks.forEach(item => item.style.display = 'block');
                }
                };

                function writeUserData(userId, email) {
        
                const db = getDatabase();
                const dbRef = ref(db);

                get(child(dbRef, "UsersList/"+ userId.uid)).then((snapshot)=>{
                    if(snapshot.exists()){
                    alert("Account already exists.");
                }
                    else{
                    set(ref(db, "UsersList/" + userId.uid),{
                    UID: userId.uid,
                    email: email,
                    })
                    .then(()=>{
                    alert("The account was registered successfully.");
                    })
                    .catch((error)=>{
                    alert("error" + error);
                    })
            }
        });
        }

        //forgot password section
        const forgotPasswordForm = document.querySelector('#forgotPassword-form');
        forgotPasswordForm.addEventListener('submit',(e) => {
            e.preventDefault();
            const forgotEmail = forgotPasswordForm['forgotPassword-email'].value;
            sendPasswordResetEmail(auth, forgotEmail)
                .then(() => {
                // Password reset email sent!
                // ..
                alert('Password reset instructions were sent to ' + forgotEmail + ".")
            })
            .catch((error) => {
                const errorCode = error.code;
                const errorMessage = error.message;
                alert(error.code);
                // ..
            });

            });

            function isEmptyOrSpaces(str){
                return str ===null || str.match(/^ *$/) !== null;
            }

            //basic validation testing for user input
            function Validation(){
                let emailregex = /^[a-zA-Z0-9]+@(gmail|yahoo|outlook|hotmail)\.com$/;
                let nameregex = /^[a-zA-Z\s]+$/;
                const email = document.getElementById("signup-email");
                const password = document.getElementById("signup-password");
                const password2 = document.getElementById("signup-confirmPassword");

                if(isEmptyOrSpaces(email.value) || isEmptyOrSpaces(password.value)){
                    alert("You cannot have any blank fields.")
                    return false;
                }
                if(!emailregex.test(email.value)){
                    alert("Enter a valid email address");
                    return false;
                }
                if(password.value != password2.value){
                    alert("Passwords do not match.");
                    return;
                }
                return true;
            }
            
            let userlink = document.getElementById('userlink');
            let signoutlink = document.getElementById('signoutlink');
            var currentUser = null;

            function getUsername(){
                let keepLoggedIn = localStorage.getItem("keepLoggedIn");
                if(keepLoggedIn == "yes"){
                    currentUser = JSON.parse(localStorage.getItem('user'))
                }
                else{
                    currentUser = JSON.parse(sessionStorage.getItem('user'))
                }
            }
          
          </script>
</body>
</html>